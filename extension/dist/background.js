import{c as i}from"./index.js";const u="https://oubprrmcbyresbexpbuq.supabase.co",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im91YnBycm1jYnlyZXNiZXhwYnVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NDQ2OTUsImV4cCI6MjA4NTIyMDY5NX0.fNPd81uplwNJsISZZpyk_od1HukPEAQkOUJvNZ0gRoU",a=i(u,d,{auth:{persistSession:!0,autoRefreshToken:!0}});chrome.action.onClicked.addListener(e=>{e.id&&chrome.sidePanel.open({tabId:e.id})});async function n(){try{const{data:{session:e}}=await a.auth.getSession();if(!e){chrome.action.setBadgeText({text:""});return}const{data:r}=await a.from("profiles").select("organization_id").eq("id",e.user.id).single();if(!(r!=null&&r.organization_id)){chrome.action.setBadgeText({text:""});return}const{count:t,error:o}=await a.from("tickets").select("*",{count:"exact",head:!0}).eq("organization_id",r.organization_id).eq("status","triage");if(o){console.error("Error fetching ticket count:",o);return}t&&t>0?(chrome.action.setBadgeText({text:t.toString()}),chrome.action.setBadgeBackgroundColor({color:"#dc2626"})):chrome.action.setBadgeText({text:""})}catch(e){console.error("Badge update error:",e)}}chrome.runtime.onInstalled.addListener(()=>{n()});chrome.alarms.create("updateBadge",{periodInMinutes:5});chrome.alarms.onAlarm.addListener(e=>{e.name==="updateBadge"&&n()});chrome.runtime.onMessage.addListener((e,r,t)=>{if(e.type==="UPDATE_BADGE")return n().then(()=>t({success:!0})),!0;if(e.type==="SYNC_AUTH_FROM_DASHBOARD"){const{accessToken:o,refreshToken:s}=e;if(o&&s)return a.auth.setSession({access_token:o,refresh_token:s}).then(()=>{console.log("Auth synced from dashboard"),n(),t({success:!0})}).catch(c=>{console.error("Failed to sync auth:",c),t({success:!1})}),!0}if(e.type==="DASHBOARD_LOGOUT")return console.log("Dashboard logout detected - clearing extension session"),a.auth.signOut().then(()=>{chrome.action.setBadgeText({text:""}),t({success:!0})}),!0});n();
