import{c as n}from"./index.js";const s="https://oubprrmcbyresbexpbuq.supabase.co",c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im91YnBycm1jYnlyZXNiZXhwYnVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NDQ2OTUsImV4cCI6MjA4NTIyMDY5NX0.fNPd81uplwNJsISZZpyk_od1HukPEAQkOUJvNZ0gRoU",a=n(s,c,{auth:{persistSession:!0,autoRefreshToken:!0}});chrome.action.onClicked.addListener(e=>{e.id&&chrome.sidePanel.open({tabId:e.id})});async function o(){try{const{data:{session:e}}=await a.auth.getSession();if(!e){chrome.action.setBadgeText({text:""});return}const{data:t}=await a.from("profiles").select("organization_id").eq("id",e.user.id).single();if(!(t!=null&&t.organization_id)){chrome.action.setBadgeText({text:""});return}const{count:r,error:i}=await a.from("tickets").select("*",{count:"exact",head:!0}).eq("organization_id",t.organization_id).eq("status","triage");if(i){console.error("Error fetching ticket count:",i);return}r&&r>0?(chrome.action.setBadgeText({text:r.toString()}),chrome.action.setBadgeBackgroundColor({color:"#dc2626"})):chrome.action.setBadgeText({text:""})}catch(e){console.error("Badge update error:",e)}}chrome.runtime.onInstalled.addListener(()=>{o()});chrome.alarms.create("updateBadge",{periodInMinutes:5});chrome.alarms.onAlarm.addListener(e=>{e.name==="updateBadge"&&o()});chrome.runtime.onMessage.addListener((e,t,r)=>{if(e.type==="UPDATE_BADGE")return o().then(()=>r({success:!0})),!0});o();
